<template>
    <Header showID showUserMinify showControlDots />
    <ProfileHeader :bg-pic="fullBannerUrl" :ava-pic="fullAvatarUrl" readOnly />
    <v-container class="pa-6" style="padding: 0 20px; margin-bottom: 48px">
        <div v-if="!hasData">
            <ProfileInfo :profile="true" :userName="data.firstName" :userSurname="data.lastName"
                :userDescription="data.fullDescription" />
            <p class="text-center text-[18px] font-[16px]">Пользователь ещё не поделился подробной информацией о себе и своих
                навыках.</p>
        </div>
        <div class="" v-else>
            <ProfileInfo :profile="true" :userName="data.firstName" :userSurname="data.lastName"
                :userDescription="data.fullDescription" />
            <UiSkills readOnly />
            <ProjectsList class="my-8" :projects="data.projects" />
        </div>
    </v-container>
    <!-- {{post}} -->
    {{ lastPart }}
    <!-- {{ users }} -->
    <Footer />
</template>

<script setup lang="ts">
// ui-kit
// import UiButton from '~/components/ui-kit/UiButton.vue'
import UiSkills from '~/components/ui-kit/UiSkills.vue'
import UiInput from '~/components/ui-kit/UiInput.vue'
// page components
import Header from '~/components/Header.vue'
import Footer from '~/components/Footer.vue'
import ProfileInfo from '~/components/profile/ProfileInfo.vue'
import ProjectsList from '~/components/profile/ProjectsList.vue'
import ProfileHeader from '~/components/profile/ProfileHeader.vue'
import ProjectBlog from '~/components/projects/ProjectBlog.vue'
import { onMounted, ref, computed } from 'vue'
import { getUserByID } from '~/API/ways/user.ts'
import { useRoute } from 'vue-router'
import { getPostByUser } from '~/API/ways/post.ts'
const route = useRoute();
const lastPart = ref(null);

let data = ref({})
onMounted(() => {
    const fullPath = window.location.origin + route.fullPath;
    const parts = fullPath.split('/');
    lastPart.value = parts[parts.length - 1];
});
onMounted(async () => {
    try {
        const response = await getUserByID(2);
        data.value = response.data.object;
        // data.value.firstName = '';
        // data.value.lastName = '';
        // data.value.fullDescription = '';
        console.log(response);
    } catch (e) {
        console.error('error:', e);
    }
})
let post = ref()
onMounted(async () => {
    try {
        const response = await getPostByUser(2);
        post.value = response.data.object;
        // data.value.firstName = '';
        // data.value.lastName = '';
        // data.value.fullDescription = '';
        console.log(response);
    } catch (e) {
        console.error('error:', e);
    }
})
const hasData = computed(() => {
    const excludedKeys = ['id', 'login', 'confirmed', 'loginType', 'errorConfirm', 'firstEntry', '', '', '']
    return Object.entries(data.value).some(([key, value]) => {
        return !excludedKeys.includes(key) && value !== null && value !== '' && (Array.isArray(value) ? value.length > 0 : true)
    })
})
const baseURL = 'http://62.217.181.172/';

const fullAvatarUrl = computed(() => {
    return data.value.pictureUrl ? `${baseURL}files/${data.value.pictureUrl}` : '';
});
const fullBannerUrl = computed(() => {
    return data.value.backgroundPictureUrl ? `${baseURL}files/${data.value.backgroundPictureUrl}` : '';
});
</script>

<style scoped></style>
